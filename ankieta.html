<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AI dla Nauczycieli</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* --- (Tw√≥j styl bez zmian) --- */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;line-height:1.6}
        .container{max-width:600px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
        .header{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;padding:30px 25px;text-align:center}
        .header h1{font-size:24px;margin-bottom:10px;font-weight:700}
        .header p{font-size:16px;opacity:.9;line-height:1.5}
        .form-container{padding:30px 25px}
        .question{margin-bottom:35px;opacity:0;transform:translateY(20px);animation:fadeInUp .6s ease forwards}
        .question:nth-child(1){animation-delay:.1s}.question:nth-child(2){animation-delay:.2s}.question:nth-child(3){animation-delay:.3s}.question:nth-child(4){animation-delay:.4s}.question:nth-child(5){animation-delay:.5s}
        @keyframes fadeInUp{to{opacity:1;transform:translateY(0)}}
        .question-title{font-size:18px;font-weight:600;color:#2c3e50;margin-bottom:15px;display:flex;align-items:center}
        .question-number{background:#3498db;color:#fff;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:bold;margin-right:15px;flex-shrink:0}
        .radio-group,.checkbox-group{display:flex;flex-direction:column;gap:12px}
        .radio-option,.checkbox-option{display:flex;align-items:center;padding:15px;background:#f8f9fa;border-radius:12px;cursor:pointer;transition:.3s;border:2px solid transparent}
        .radio-option:hover,.checkbox-option:hover{background:#e3f2fd;border-color:#2196f3;transform:translateX(5px)}
        .radio-option.selected,.checkbox-option.selected{background:#e8f5e8;border-color:#4caf50}
        .radio-option input,.checkbox-option input{margin-right:12px;transform:scale(1.2)}
        .textarea-field,.text-field{width:100%;padding:15px;border:2px solid #e0e0e0;border-radius:12px;font-size:16px;font-family:inherit;resize:vertical;min-height:100px;transition:border-color .3s ease}
        .text-field{min-height:50px}
        .textarea-field:focus,.text-field:focus{outline:none;border-color:#3498db;box-shadow:0 0 0 3px rgba(52,152,219,.1)}
        .submit-section{text-align:center;padding:30px 25px;background:#f8f9fa;border-top:1px solid #e0e0e0}
        .submit-btn{background:linear-gradient(135deg,#4caf50,#45a049);color:#fff;border:none;padding:18px 40px;font-size:18px;font-weight:600;border-radius:50px;cursor:pointer;transition:.3s;box-shadow:0 4px 15px rgba(76,175,80,.3)}
        .submit-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(76,175,80,.4)}
        .submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}
        .export-btn{background:linear-gradient(135deg,#2196f3,#1976d2);color:#fff;border:none;padding:12px 25px;font-size:16px;font-weight:600;border-radius:25px;cursor:pointer;margin-left:15px;transition:.3s;box-shadow:0 4px 15px rgba(33,150,243,.3)}
        .export-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(33,150,243,.4)}
        .success-message{background:#d4edda;color:#155724;padding:20px;border-radius:12px;margin-top:20px;text-align:center;font-weight:600;display:none}
        .progress-bar{width:100%;height:6px;background:#e0e0e0;border-radius:3px;overflow:hidden;margin-bottom:20px}
        .progress-fill{height:100%;background:linear-gradient(90deg,#4caf50,#45a049);width:0%;transition:width .3s ease}
        .admin-panel{margin-top:30px;padding:20px;background:#f0f8ff;border:2px solid #4169e1;border-radius:10px;display:none}
        .admin-panel h3{color:#4169e1;margin-bottom:15px}
        .admin-panel p{margin-bottom:15px;font-weight:600}
        .delete-btn{background:linear-gradient(135deg,#dc3545,#c82333);margin-left:10px}
        @media (max-width:480px){
            body{padding:10px}
            .header{padding:20px 15px}
            .header h1{font-size:20px}
            .form-container{padding:20px 15px}
            .question-title{font-size:16px}
            .submit-section{padding:20px 15px}
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üìö AI dla Nauczycieli</h1>
        <p>Pom√≥≈º nam stworzyƒá ebook dopasowany do Twoich potrzeb! Twoje odpowiedzi sƒÖ bardzo wa≈ºne dla nas.</p>
    </div>

    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

    <form id="surveyForm" class="form-container">
        <!-- Pytanie 1 -->
        <div class="question">
            <div class="question-title"><span class="question-number">1</span>Co najbardziej interesuje Ciƒô w tematyce sztucznej inteligencji w edukacji?</div>
            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="q1" value="Praktyczne zastosowania w pracy nauczyciela">Praktyczne zastosowania w pracy nauczyciela</label>
                <label class="radio-option"><input type="radio" name="q1" value="Wykorzystanie AI przez uczni√≥w">Wykorzystanie AI przez uczni√≥w</label>
                <label class="radio-option"><input type="radio" name="q1" value="Podstawy dzia≈Çania AI">Podstawy dzia≈Çania AI</label>
                <label class="radio-option"><input type="radio" name="q1" value="Aspekty etyczne i prawne">Aspekty etyczne i prawne</label>
            </div>

            <input type="text" name="q1_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá)" style="margin-top:15px;">

        </div>

        <!-- Pytanie 2 -->
        <div class="question">
            <div class="question-title"><span class="question-number">2</span>Jakiego rodzaju tre≈õci oczekujesz w ebooku? (mo≈ºesz zaznaczyƒá kilka)</div>
            <div class="checkbox-group">
                <label class="checkbox-option"><input type="checkbox" name="q2" value="Przyk≈Çady i inspiracje z praktyki szkolnej">Przyk≈Çady i inspiracje z praktyki szkolnej</label>
                <label class="checkbox-option"><input type="checkbox" name="q2" value="Instrukcje krok po kroku (‚Äûjak to zrobiƒá‚Äù)">Instrukcje krok po kroku (‚Äûjak to zrobiƒá‚Äù)</label>
                <label class="checkbox-option"><input type="checkbox" name="q2" value="Teoretyczne wyja≈õnienia i definicje">Teoretyczne wyja≈õnienia i definicje</label>
                <label class="checkbox-option"><input type="checkbox" name="q2" value="Gotowe narzƒôdzia i linki">Gotowe narzƒôdzia i linki</label>
                <label class="checkbox-option"><input type="checkbox" name="q2" value="Scenariusze zajƒôƒá i karty pracy">Scenariusze zajƒôƒá i karty pracy</label>
            </div>
            <input type="text" name="q2_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá)" style="margin-top:15px;">

        </div>

        <!-- Pytanie 3 -->
        <div class="question">
            <div class="question-title"><span class="question-number">3</span>Jakiego poziomu szczeg√≥≈Çowo≈õci potrzebujesz?</div>
            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="q3" value="Bardzo podstawowy (dla poczƒÖtkujƒÖcych)">Bardzo podstawowy (dla poczƒÖtkujƒÖcych)</label>
                <label class="radio-option"><input type="radio" name="q3" value="≈öredniozaawansowany (praktyczne zastosowania)">≈öredniozaawansowany (praktyczne zastosowania)</label>
                <label class="radio-option"><input type="radio" name="q3" value="Zaawansowany (bardziej eksperckie tre≈õci)">Zaawansowany (bardziej eksperckie tre≈õci)</label>
            </div>
            <!-- <input type="text" name="q3_other" class="text-field" placeholder="Inne narzƒôdzia (jakie?)" style="margin-top:15px;"> -->
        </div>

        <!-- Pytanie 4 -->
        <div class="question">
            <div class="question-title"><span class="question-number">4</span>Jakie konkretne narzƒôdzia AI chcia≈Ç(a)by≈õ zobaczyƒá w E-booku? (mo≈ºesz zaznaczyƒá kilka)</div>
            <div class="checkbox-group">
                <label class="checkbox-option"><input type="checkbox" name="q4" value="ChatGPT">ChatGPT</label>
                <label class="checkbox-option"><input type="checkbox" name="q4" value="Canva AI">Canva AI</label>
                <label class="checkbox-option"><input type="checkbox" name="q4" value="Copilot (Microsoft/Office)">Copilot (Microsoft/Office)</label>
                <label class="checkbox-option"><input type="checkbox" name="q4" value="Narzƒôdzia do generowania obraz√≥w (np. DALL¬∑E, Stable Diffusion)">Narzƒôdzia do generowania obraz√≥w (np. DALL¬∑E, Stable Diffusion)</label>
                <label class="checkbox-option"><input type="checkbox" name="q4" value="Narzƒôdzia do tworzenia quiz√≥w/test√≥w z AI">Narzƒôdzia do tworzenia quiz√≥w/test√≥w z AI</label>

            </div>
            <input type="text" name="q4_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá?)" style="margin-top:15px;">
        </div>

        <!-- Pytanie 5 -->
        <div class="question">
            <div class="question-title"><span class="question-number">5</span>Jakie wyzwania lub problemy w pracy chcia≈Ç(a)by≈õ rozwiƒÖzaƒá dziƒôki AI? (mo≈ºesz zaznaczyƒá kilka)</div>
            <div class="checkbox-group">
                <label class="checkbox-option"><input type="checkbox" name="q5" value="Przyspieszenie przygotowania materia≈Ç√≥w dydaktycznych">Przyspieszenie przygotowania materia≈Ç√≥w dydaktycznych</label>
                <label class="checkbox-option"><input type="checkbox" name="q5" value="Tworzenie test√≥w i ƒáwicze≈Ñ">Tworzenie test√≥w i ƒáwicze≈Ñ</label>
                <label class="checkbox-option"><input type="checkbox" name="q5" value="Opracowywanie scenariuszy lekcji">Opracowywanie scenariuszy lekcji</label>
                <label class="checkbox-option"><input type="checkbox" name="q5" value="Indywidualizacja pracy z uczniem">Indywidualizacja pracy z uczniem</label>
                <label class="checkbox-option"><input type="checkbox" name="q5" value="U≈Çatwienie pracy administracyjnej/nadmiar biurokracji">U≈Çatwienie pracy administracyjnej/nadmiar biurokracji</label>
            </div>
            <input type="text" name="q5_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá?)" style="margin-top:15px;">

        </div>

        <!-- Pytanie 6 -->
        <div class="question">
            <div class="question-title"><span class="question-number">6</span>Kt√≥ra forma tre≈õci by≈Çaby dla Ciebie najbardziej pomocna? (mo≈ºesz zaznaczyƒá kilka)</div>
            <div class="checkbox-group">
            <!-- <textarea name="q6" class="textarea-field" placeholder="Opisz tematy, kt√≥re najbardziej Ciƒô interesujƒÖ..."></textarea> -->
            <label class="checkbox-option"><input type="checkbox" name="q6" value="Checklisty i podsumowania">Checklisty i podsumowania</label>
            <label class="checkbox-option"><input type="checkbox" name="q6" value="Kr√≥tkie poradniki krok po kroku">Kr√≥tkie poradniki krok po kroku</label>
            <label class="checkbox-option"><input type="checkbox" name="q6" value="Infografiki, schematy">Infografiki, schematy</label>
            <label class="checkbox-option"><input type="checkbox" name="q6" value="Opisy case studies">Opisy case studies</label>
            <label class="checkbox-option"><input type="checkbox" name="q6" value="Gotowe materia≈Çy dydaktyczne">Gotowe materia≈Çy dydaktyczne</label>
        </div>
        <input type="text" name="q6_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá?)" style="margin-top:15px;">

        <!-- Pytanie 7 -->
        <div class="question">
            <div class="question-title"><span class="question-number">7</span>Na ile wa≈ºne sƒÖ dla Ciebie informacje o aspektach prawnych i etycznych korzystania z AI (np. prawa autorskie, RODO, AI Act)?</div>
            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="q7" value="Bardzo wa≈ºne">Bardzo wa≈ºne</label>
                <label class="radio-option"><input type="radio" name="q7" value="Wa≈ºne, ale og√≥lnie">Wa≈ºne, ale og√≥lnie</label>
                <label class="radio-option"><input type="radio" name="q7" value="Ma≈Ço istotne">Ma≈Ço istotne</label>
            </div>
        </div>

        <!-- Pytanie 8 -->
        <div class="question">
            <div class="question-title"><span class="question-number">8</span>Czy chcia≈Ç(a)by≈õ, aby ebook zawiera≈Ç gotowe scenariusze lekcji lub karty pracy dla uczni√≥w?</div>
            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="q8" value="Tak, pe≈Çne materia≈Çy do wykorzystania">Tak, pe≈Çne materia≈Çy do wykorzystania</label>
                <label class="radio-option"><input type="radio" name="q8" value="Tak, ale tylko przyk≈Çadowe inspiracje">Tak, ale tylko przyk≈Çadowe inspiracje</label>
                <label class="radio-option"><input type="radio" name="q8" value="Nie, wolƒô samodzielnie tworzyƒá">Nie, wolƒô samodzielnie tworzyƒá</label>
                <!-- <label class="radio-option"><input type="radio" name="q8" value="Wyja≈õnienie etyki i bezpiecze≈Ñstwa">Wyja≈õnienie etyki i bezpiecze≈Ñstwa</label> -->
            </div>
        </div>

        <!-- Pytanie 9 -->
        <div class="question">
            <div class="question-title"><span class="question-number">9</span>Jak d≈Çugi powinien byƒá ebook, aby by≈Ç dla Ciebie u≈ºyteczny?</div>
            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="q9" value="Kr√≥tki przewodnik (10‚Äì20 stron)">Kr√≥tki przewodnik (10‚Äì20 stron)</label>
                <label class="radio-option"><input type="radio" name="q9" value="≈öredni (20‚Äì40 stron)">≈öredni (20‚Äì40 stron)</label>
                <label class="radio-option"><input type="radio" name="q9" value="Rozbudowany materia≈Ç (powy≈ºej 40 stron)">Rozbudowany materia≈Ç (powy≈ºej 40 stron)</label>
            </div>
        </div>

        <!-- Pytanie 10 -->
        <div class="question">
            <div class="question-title"><span class="question-number">10</span>Co Twoim zdaniem koniecznie powinno znale≈∫ƒá siƒô w takim ebooku?</div>
            <div class="checkbox-group">
                <!-- <textarea name="q6" class="textarea-field" placeholder="Opisz tematy, kt√≥re najbardziej Ciƒô interesujƒÖ..."></textarea> -->
                <label class="checkbox-option"><input type="checkbox" name="q10" value="Praktyczne przyk≈Çady z lekcji">Praktyczne przyk≈Çady z lekcji</label>
                <label class="checkbox-option"><input type="checkbox" name="q10" value="Opis sprawdzonych narzƒôdzi">Opis sprawdzonych narzƒôdzi</label>
                <label class="checkbox-option"><input type="checkbox" name="q10" value="Scenariusze zajƒôƒá dla r√≥≈ºnych przedmiot√≥w">Scenariusze zajƒôƒá dla r√≥≈ºnych przedmiot√≥w</label>
                <label class="checkbox-option"><input type="checkbox" name="q10" value="Poradnik prawno-etyczny">Poradnik prawno-etyczny</label>
                <label class="checkbox-option"><input type="checkbox" name="q10" value="Wskaz√≥wki dotyczƒÖce pracy z uczniami nad AI">Wskaz√≥wki dotyczƒÖce pracy z uczniami nad AI</label>
            </div>
            <input type="text" name="q10_other" class="text-field" placeholder="Inne (proszƒô dopisaƒá?)" style="margin-top:15px;">
    </div>
        </div>
    </form>

    <div class="submit-section">
        <button type="submit" class="submit-btn" id="submitBtn">Wy≈õlij ankietƒô</button>
        <div class="success-message" id="successMessage">
            ‚úÖ Dziƒôkujemy za wype≈Çnienie ankiety! Twoje odpowiedzi zosta≈Çy zapisane.
            <br><br><strong>Dziƒôkujemy<br>Ania & Artur</strong>
        </div>

        <!-- Panel Administratora -->
        <div id="adminPanel" class="admin-panel">
            <h3>üîê Panel Administratora</h3>
            <p>Liczba odpowiedzi: <span id="responseCount">0</span></p>
            <button type="button" class="export-btn" id="exportBtn">üìä Eksportuj wszystkie odpowiedzi</button>
            <button type="button" class="export-btn delete-btn" id="clearBtn">üóëÔ∏è Wyczy≈õƒá dane</button>
        </div>
    </div>
</div>

<script>
    /* ===========================================
       Ankieta AI dla Nauczycieli ‚Äì skrypt z ‚ÄûInne‚Äù
       =========================================== */
    
    /* --- Konfiguracja --- */
    const API_URL = 'survey.php';
    const urlParams  = new URLSearchParams(window.location.search);
    const isAdmin    = urlParams.get('admin') === 'true';
    const adminToken = urlParams.get('token') || '';
    
    /* Grupy pyta≈Ñ */
    const RADIO_GROUPS    = ['q1','q3','q7','q8','q9'];       // tylko q1 ma "Inne"
    const CHECKBOX_GROUPS = ['q2','q4','q5','q6','q10'];      // wszystkie z "Inne"
    const OTHER_FIELDS    = ['q1_other','q2_other','q4_other','q5_other','q6_other','q10_other'];
    
    const $  = (s, r=document)=>r.querySelector(s);
    const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));
    const getRadioValue    = name => { const el = $(`input[name="${name}"]:checked`); return el ? el.value : ''; };
    const getCheckboxValues= name => $$( `input[name="${name}"]:checked` ).map(e=>e.value);
    const getInputValue    = name => { const el = $(`[name="${name}"]`); return el && !el.disabled ? (el.value||'').trim() : ''; };
    
    /* --- UI: klasy .selected --- */
    document.addEventListener('change', (e) => {
      const t = e.target;
      if (t.matches('input[type="radio"]')) {
        $$(`input[name="${t.name}"]`).forEach(r => r.closest('.radio-option')?.classList.remove('selected'));
        t.closest('.radio-option')?.classList.add('selected');
        // Synchronizacja dostƒôpno≈õci ‚ÄûInne‚Äù dla q1
        if (t.name === 'q1') syncQ1Other();
        updateProgress();
      } else if (t.matches('input[type="checkbox"]')) {
        t.closest('.checkbox-option')?.classList.toggle('selected', t.checked);
        updateProgress();
      }
    });
    
    /* Pole ‚ÄûInne‚Äù przy q1: pisanie wy≈ÇƒÖcza radia i je czy≈õci */
    const q1OtherEl = document.querySelector('[name="q1_other"]');
    if (q1OtherEl) {
      q1OtherEl.addEventListener('input', () => {
        const v = q1OtherEl.value.trim();
        if (v.length > 0) {
          $$('input[name="q1"]').forEach(r => {
            r.checked = false;
            r.closest('.radio-option')?.classList.remove('selected');
          });
        }
        syncQ1Other();
        updateProgress();
      });
    }
    
    /* Teksty ‚ÄûInne‚Äù w checkboxach ‚Äì po prostu licz i zapisuj */
    document.querySelectorAll('input[type="text"], textarea').forEach(el => {
      if (el.name !== 'q1_other') el.addEventListener('input', updateProgress);
    });
    
    /* Zablokuj/odblokuj q1_other zale≈ºnie od stanu radia */
    function syncQ1Other() {
      if (!q1OtherEl) return;
      const anyRadio = !!getRadioValue('q1');
      if (anyRadio) {
        q1OtherEl.value = '';
        q1OtherEl.disabled = true;
        q1OtherEl.classList.add('disabled');
      } else {
        q1OtherEl.disabled = false;
        q1OtherEl.classList.remove('disabled');
      }
    }
    
    /* Odtw√≥rz stan zaznacze≈Ñ i dostƒôpno≈õci na starcie */
    function initSelectedStates() {
      $$('input[type="radio"]').forEach(r => { if (r.checked) r.closest('.radio-option')?.classList.add('selected'); });
      $$('input[type="checkbox"]').forEach(c => { c.closest('.checkbox-option')?.classList.toggle('selected', c.checked); });
      syncQ1Other();
    }
    initSelectedStates();
    
    /* --- Pasek postƒôpu --- */
    function updateProgress(){
      const total = 10;
      let answered = 0;
    
      // q1: albo radio, albo ‚ÄûInne‚Äù (gdy pole aktywne)
      const q1Radio = !!getRadioValue('q1');
      const q1Other = q1OtherEl && !q1OtherEl.disabled && q1OtherEl.value.trim().length > 0;
      if (q1Radio || q1Other) answered++;
    
      // Pozosta≈Çe radia
      ['q3','q7','q8','q9'].forEach(n => { if (getRadioValue(n)) answered++; });
    
      // Checkboxy ‚Äì liczymy, je≈õli cokolwiek zaznaczone LUB ‚ÄûInne‚Äù niepuste
      CHECKBOX_GROUPS.forEach(n => {
        const hasAny = getCheckboxValues(n).length > 0;
        const otherEl = $(`[name="${n}_other"]`);
        const hasOther = otherEl && !otherEl.disabled && otherEl.value.trim().length > 0;
        if (hasAny || hasOther) answered++;
      });
    
      const pf = document.getElementById('progressFill');
      if (pf) pf.style.width = (answered / total * 100) + '%';
    }
    updateProgress();
    
    /* --- Submit --- */
    document.getElementById('submitBtn')?.addEventListener('click', async (e)=>{
      e.preventDefault();
      const btn = document.getElementById('submitBtn'); if (btn) btn.disabled = true;
    
      const q1Val   = getRadioValue('q1');
      const q1Other = q1Val ? '' : getInputValue('q1_other'); // wymuszenie wzajemnego wykluczenia
    
      const responses = {
        q1: q1Val,
        q1_other: q1Other,
    
        q2: getCheckboxValues('q2').join('; '),
        q2_other: getInputValue('q2_other'),
    
        q3: getRadioValue('q3'),
    
        q4: getCheckboxValues('q4').join('; '),
        q4_other: getInputValue('q4_other'),
    
        q5: getCheckboxValues('q5').join('; '),
        q5_other: getInputValue('q5_other'),
    
        q6: getCheckboxValues('q6').join('; '),
        q6_other: getInputValue('q6_other'),
    
        q7: getRadioValue('q7'),
        q8: getRadioValue('q8'),
        q9: getRadioValue('q9'),
    
        q10: getCheckboxValues('q10').join('; '),
        q10_other: getInputValue('q10_other'),
    
        timestamp: new Date().toLocaleString('pl-PL'),
        id: Date.now()
      };
    
      try{
        const res = await fetch(`${API_URL}?action=save`,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(responses),
          cache: 'no-store'
        });
        const data = await res.json();
        if(!data.ok) throw new Error(data.error || 'B≈ÇƒÖd zapisu');
    
        const okBox = document.getElementById('successMessage');
        if (okBox) okBox.style.display='block';
        if (btn) { btn.textContent='Ankieta wys≈Çana ‚úì'; btn.disabled=true; }
        if (isAdmin) await refreshAdminCount();
        okBox?.scrollIntoView({behavior:'smooth'});
      }catch(err){
        alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas zapisu. Spr√≥buj ponownie.\n\nSzczeg√≥≈Çy: ' + err.message);
        console.error(err);
        if (btn) btn.disabled = false;
      }
    });
    
    /* --- Panel Admina --- */
    const adminPanel = document.getElementById('adminPanel');
    if (isAdmin && adminPanel) {
      adminPanel.style.display='block';
      refreshAdminCount();
      document.getElementById('exportBtn')?.addEventListener('click', exportToExcel);
      document.getElementById('clearBtn')?.addEventListener('click', clearAllData);
    }
    
    async function fetchAllResponses(){
      const url = `${API_URL}?action=list&token=${encodeURIComponent(adminToken)}&t=${Date.now()}`;
      const res = await fetch(url, {cache:'no-store'});
      if(!res.ok) throw new Error('B≈ÇƒÖd pobierania listy');
      const data = await res.json();
      if(!data.ok) throw new Error(data.error || 'B≈ÇƒÖd listy');
      return data.data || [];
    }
    
    async function refreshAdminCount(){
      try{
        const list = await fetchAllResponses();
        const el = document.getElementById('responseCount');
        if (el) el.textContent = list.length;
        return list;
      }catch(err){
        console.error(err);
        alert('Nie uda≈Ço siƒô pobraƒá liczby odpowiedzi (sprawd≈∫ token w URL oraz survey.php).');
        return [];
      }
    }
    
    /* Autoload XLSX je≈õli brakuje i zr√≥b eksport */
    async function exportToExcel(){
      try{
        if (typeof XLSX === 'undefined') {
          if (!document.getElementById('xlsx-loader')) {
            const s = document.createElement('script');
            s.id  = 'xlsx-loader';
            s.src = 'https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js';
            s.onload = () => exportToExcel();
            s.onerror = () => alert('Nie uda≈Ço siƒô za≈Çadowaƒá biblioteki XLSX z CDN.');
            document.head.appendChild(s);
            alert('≈Åadujƒô bibliotekƒô XLSX z CDN ‚Äì spr√≥buj ponownie za chwilƒô.');
          }
          return;
        }
    
        const data = await fetchAllResponses();
        if (data.length === 0) { alert('Brak danych do eksportu'); return; }
    
        const exportData = data.map(r=>({
          'ID': r.id || '',
          'Data wype≈Çnienia': r.timestamp || '',
    
          '1. Co interesuje Ciƒô w AI w edukacji': r.q1 || '',
          '1a. Inne (q1)': r.q1_other || '',
    
          '2. Jakich tre≈õci oczekujesz (ebook)': r.q2 || '',
          '2a. Inne (q2)': r.q2_other || '',
    
          '3. Poziom szczeg√≥≈Çowo≈õci': r.q3 || '',
    
          '4. Konkretnie jakie narzƒôdzia AI': r.q4 || '',
          '4a. Inne (q4)': r.q4_other || '',
    
          '5. Jakie wyzwania chcesz rozwiƒÖzaƒá': r.q5 || '',
          '5a. Inne (q5)': r.q5_other || '',
    
          '6. Preferowana forma tre≈õci': r.q6 || '',
          '6a. Inne (q6)': r.q6_other || '',
    
          '7. Wa≈ºno≈õƒá praw/etyki (RODO/AI Act)': r.q7 || '',
          '8. Scenariusze/karty pracy w ebooku': r.q8 || '',
          '9. D≈Çugo≈õƒá ebooka': r.q9 || '',
    
          '10. Co koniecznie musi byƒá': r.q10 || '',
          '10a. Inne (q10)': r.q10_other || ''
        }));
    
        const ws = XLSX.utils.json_to_sheet(exportData);
        ws['!cols'] = [
          {wch:12},{wch:20},
          {wch:42},{wch:24},
          {wch:42},{wch:24},
          {wch:28},
          {wch:36},{wch:24},
          {wch:40},{wch:24},
          {wch:34},{wch:24},
          {wch:36},{wch:36},{wch:26},
          {wch:42},{wch:24}
        ];
    
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Ankieta AI');
        const fileName = `Ankieta_AI_Nauczyciele_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);
        alert('Plik Excel zosta≈Ç pobrany!');
      }catch(err){
        console.error(err);
        alert('B≈ÇƒÖd eksportu: ' + err.message);
      }
    }
    
    async function clearAllData(){
      if(!adminToken){ alert('Brak tokenu admina w URL (?token=...)'); return; }
      if(!confirm('Czy na pewno chcesz usunƒÖƒá wszystkie odpowiedzi? Tej operacji nie da siƒô cofnƒÖƒá.')) return;
      try{
        const res = await fetch(`${API_URL}?action=clear`,{
          method:'POST',
          headers:{'Content-Type':'application/x-www-form-urlencoded'},
          body: new URLSearchParams({token: adminToken}),
          cache: 'no-store'
        });
        const data = await res.json();
        if(!data.ok) throw new Error(data.error || 'B≈ÇƒÖd czyszczenia');
        await refreshAdminCount();
        alert('Wszystkie dane zosta≈Çy usuniƒôte.');
      }catch(err){
        console.error(err);
        alert('Nie uda≈Ço siƒô usunƒÖƒá danych: ' + err.message);
      }
    }
    </script>
    
    
</body>
</html>